$(function(){let menu={};let h3_index=0;let h4_index=0;let h2_index=0;let h2='';let h3='';let h4='';$(".post-body h2,h3,h4").each(function(){if($(this).is("h2")){h2_index++;h2=h2_index+'.'+$(this).text().replace(/ /g,"");$(this).attr("id",h2);if(menu[h2]==undefined){menu[h2]={};}
    h3_index=0;}
    if($(this).is("h3")){h3_index++;h3=h2_index+'.'+h3_index+"."+$(this).text().replace(/ /g,"");$(this).attr("id",h3);if(menu[h2][h3]==undefined){menu[h2][h3]=[]}
        h4_index=1;}
    if($(this).attr("id")=='reply-title'){return true;}
    if($(this).is("h4")){h4=h2_index+'.'+h3_index+"."+h4_index+"."+$(this).text().replace(/ /g,"")
        $(this).attr("id",h4);menu[h2][h3].push(h4);h4_index++;}});if(JSON.stringify(h2)!='{}'){let h2List;let h2Node;let h3List;let h3Node;let h4List;let h4Node;h2List=$('<ol class="nav"></ol>');for(let i in menu){h2=menu[i];h2Node=$('<li class="nav-item nav-level-2"><a class="nav-link" href="#'+i+'"><span class="nav-text">'+i+"</span></a></li>");if(JSON.stringify(h2)!='{}'){h3List=$('<ol class="nav-child" style="padding-bottom: 0px;"></ol>');for(let j in h2){h3=h2[j];h3Node=$('<li class="nav-item nav-level-3"><a class="nav-link" href="#'+j+'"><span class="nav-text">'+j+"</span></a></li>");h3List.append(h3Node)}
    if(h3.length){h4List=$('<ol class="nav-child" style="padding-bottom: 0px;"></ol>');for(let k in h3){h4=h3[k];h4Node=$('<li class="nav-item nav-level-4"><a class="nav-link" href="#'+h4+'"><span class="nav-text">'+h4+"</span></a></li>");h4List.append(h4Node)}
        if(h3List.text().length){h3Node.append(h4List)}}
    if(h3List.text().length){h2Node.append(h3List)}}
    h2List.append(h2Node)}
    if(h2List.text()){$(".post-toc-content").html(h2List[0].outerHTML)}else{$(".post-toc-content").html('<p class="post-toc-empty">此文章未包含目录</p>')}}
    var tocSelector=".post-toc";var $tocSelector=$(tocSelector);var activeCurrentSelector=".active-current";$tocSelector.on("activate.bs.scrollspy",function(){var $currentActiveElement=$(tocSelector+" .active").last();removeCurrentActiveClass();$currentActiveElement.addClass("active-current");$tocSelector[0].scrollTop=$currentActiveElement.position().top}).on("clear.bs.scrollspy",function(){removeCurrentActiveClass()});function removeCurrentActiveClass(){$(tocSelector+" "+activeCurrentSelector).removeClass(activeCurrentSelector.substring(1))}
    function processTOC(){getTOCMaxHeight();toggleTOCOverflowIndicators()}
    function getTOCMaxHeight(){var height=$(".sidebar").height()-$tocSelector.position().top-$(".post-toc-indicator-bottom").height();$tocSelector.css("height",height);return height}
    function toggleTOCOverflowIndicators(){tocOverflowIndicator(".post-toc-indicator-top",$tocSelector.scrollTop()>0?"show":"hide");tocOverflowIndicator(".post-toc-indicator-bottom",$tocSelector.scrollTop()>=$tocSelector.find("ol").height()-$tocSelector.height()?"hide":"show")}
    $(document).on("sidebar.motion.complete",function(){processTOC()});$("body").scrollspy({target:tocSelector});$(window).on("resize",function(){if($(".sidebar").hasClass("sidebar-active")){processTOC()}});onScroll($tocSelector);function onScroll(element){element.on("mousewheel DOMMouseScroll",function(event){var oe=event.originalEvent;var delta=oe.wheelDelta||-oe.detail;this.scrollTop+=(delta<0?1:-1)*30;event.preventDefault();toggleTOCOverflowIndicators()})}
    function tocOverflowIndicator(indicator,action){var $indicator=$(indicator);var opacity=action==="show"?1:0;$indicator.velocity?$indicator.velocity("stop").velocity({opacity:opacity},{duration:100}):$indicator.stop().animate({opacity:opacity},100)}
    var html=$("html");var TAB_ANIMATE_DURATION=200;var hasVelocity=$.isFunction(html.velocity);$(".sidebar-nav li").on("click",function(){var item=$(this);var activeTabClassName="sidebar-nav-active";var activePanelClassName="sidebar-panel-active";if(item.hasClass(activeTabClassName)){return}
        var currentTarget=$("."+activePanelClassName);var target=$("."+item.data("target"));hasVelocity?currentTarget.velocity("transition.slideUpOut",TAB_ANIMATE_DURATION,function(){target.velocity("stop").velocity("transition.slideDownIn",TAB_ANIMATE_DURATION).addClass(activePanelClassName)}):currentTarget.animate({opacity:0},TAB_ANIMATE_DURATION,function(){currentTarget.hide();target.stop().css({"opacity":0,"display":"block"}).animate({opacity:1},TAB_ANIMATE_DURATION,function(){currentTarget.removeClass(activePanelClassName);target.addClass(activePanelClassName)})});item.siblings().removeClass(activeTabClassName);item.addClass(activeTabClassName)});$(".post-toc a").on("click",function(e){e.preventDefault();var targetSelector=NexT.utils.escapeSelector(this.getAttribute("href"));var offset=$(targetSelector).offset().top;hasVelocity?html.velocity("stop").velocity("scroll",{offset:offset+"px",mobileHA:false}):$("html, body").stop().animate({scrollTop:offset},500)});NexT.motion.middleWares.sidebar=function(){var $tocContent=$(".post-toc-content");if(CONFIG.scheme!=="Pisces"&&(CONFIG.sidebar.display==="post"||CONFIG.sidebar.display==="always")){if($tocContent.length>0&&$tocContent.html().trim().length>0){NexT.utils.displaySidebar()}}};function secondToDate(second){if(!second){return 0}
        var time=new Array(0,0,0,0,0);if(second>=365*24*3600){time[0]=parseInt(second/(365*24*3600));second%=365*24*3600}
        if(second>=24*3600){time[1]=parseInt(second/(24*3600));second%=24*3600}
        if(second>=3600){time[2]=parseInt(second/3600);second%=3600}
        if(second>=60){time[3]=parseInt(second/60);second%=60}
        if(second>0){time[4]=second}
        return time}
    function setTime(){var create_time=Math.round(new Date(Date.UTC(2019,3,11,11,11,11)).getTime()/1000);var timestamp=Math.round((new Date().getTime()+8*60*60*1000)/1000);currentTime=secondToDate((timestamp-create_time));currentTimeHtml=currentTime[0]+"年"+currentTime[1]+"天"+currentTime[2]+"时"+currentTime[3]+"分"+currentTime[4]+"秒";document.getElementById("run_time").innerHTML=currentTimeHtml}
    setInterval(setTime,1000)});
